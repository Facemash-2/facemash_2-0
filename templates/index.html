<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hot or Not Voting</title>
    <!-- Google Fonts for styling -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- CSS file for custom styling -->
    <link rel="stylesheet" href="/static/styles.css">
    <!-- JavaScript for interactive logic -->
    <script>
        // Fetch a random pair from the backend
        function getRandomPair() {
            fetch('/get_random_pair')
                .then(response => response.json())
                .then(data => {
                    const leftPerson = document.getElementById('left-person');
                    const rightPerson = document.getElementById('right-person');

                    leftPerson.innerHTML = `
                        <img src="/static/images/${data[0].name.toLowerCase()}.jpg" alt="${data[0].name}" class="person-image">
                        <button onclick="voteFor('${data[0]._id}')" class="vote-button">Vote for ${data[0].name}</button>
                    `;

                    rightPerson.innerHTML = `
                        <img src="/static/images/${data[1].name.toLowerCase()}.jpg" alt="${data[1].name}" class="person-image">
                        <button onclick="voteFor('${data[1]._id}')" class="vote-button">Vote for ${data[1].name}</button>
                    `;
                });
        }

        // Send voting data with names instead of IDs
        function voteFor(selected_id, rejected_id) {
    console.log("Data being sent to /vote:", { selected_id, rejected_id });  // Debug output

    fetch('/vote', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ selected_id, rejected_id })  // Ensure correct variable names
    })
    .then(response => response.json())
    .then(data => {
        console.log("Response from server:", data);
        getRandomPair();  // Fetch a new pair after voting
    })
    .catch(error => console.error("Error during voting:", error));
}
        // Fetch and update the leaderboard
function updateLeaderboard() {
    fetch('/get_leaderboard')
        .then(response => response.json())
        .then(data => {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '';  // Clear existing content

            data.forEach((item, index) => {
                const row = document.createElement('tr');

                const positionCell = document.createElement('td');
                const nameCell = document.createElement('td');
                const countCell = document.createElement('td');
                const scoreCell = document.createElement('td');
                const likeabilityCell = document.createElement('td');  // New cell for likeability

                // Safely get the likeability value, or set a default if undefined
                const likeability = item.likeability !== undefined ? item.likeability : 0;

                positionCell.innerText = index + 1;  // Position in the leaderboard
                nameCell.innerText = item.name;  // Candidate's name
                countCell.innerText = item.count;  // Vote count
                scoreCell.innerText = item.score;  // Score
                likeabilityCell.innerText = likeability.toFixed(2) + "%";  // Handle missing likeability

                row.appendChild(positionCell);  // Append cells to the row
                row.appendChild(nameCell);
                row.appendChild(countCell);
                row.appendChild(likeabilityCell);  // Append likeability

                leaderboard.appendChild(row);  // Append the row to the leaderboard
            });
        })
        .catch(error => console.error("Error updating leaderboard:", error));
}

        // On page load, fetch the initial random pair and update the leaderboard
        window.onload = function() {
            getRandomPair();  // Get initial random pair
            updateLeaderboard();  // Update the leaderboard
            setInterval(updateLeaderboard, 5000);  // Refresh every 5 seconds
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>Hot or Not</h1>
        <p>vote for the person you find hotter below</p>

        <!-- Section for displaying two candidates for voting -->
        <div class="vote-pair">
            <div id="left-person" class="vote-section">
                <!-- Content is dynamically inserted here -->
            </div>

        
            <img src="/static/versus.png" style="max-width: 200px;"></img>
        

            <div id="right-person" class="vote-section">
                <!-- Content is dynamically inserted here -->
            </div>
        </div>

        <h2>Leaderboard</h2>
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Votes</th>
                    <th>Likeability</th>
                </tr>
            </thead>
            <tbody id="leaderboard">
                <!-- Dynamic content will be inserted here -->
            </tbody>
        </table>
    </div>
</body>
</html>
